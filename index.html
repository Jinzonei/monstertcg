<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monster TCG</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            text-align: center;
            color: #444;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fafafa;
            border-radius: 6px;
            border: 1px solid #eee;
        }
        .resource-display {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .resource-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 10px;
        }
        .resource-value {
            font-size: 1.5em;
        }
        .resource-per-second {
            font-size: 0.8em;
            color: #777;
        }
        .button-group {
            text-align: center;
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: #fff;
            background-color: #007bff;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #card-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        #deck-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            border: 2px dashed #999;
            padding: 10px;
            border-radius: 8px;
            min-height: 180px;
            align-items: center;
        }
        .card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            width: 150px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        .card.selected {
            border: 2px solid #007bff;
        }
        .card.in-deck {
            border: 2px solid #28a745;
        }
        .card.Common { background-color: #b3e0ff; }
        .card.Uncommon { background-color: #c2f0c2; }
        .card.Rare { background-color: #ffccff; }
        .card.Epic { background-color: #ffb3b3; }
        .card.Legendary { background-color: #fffacd; }
        .card .hover-popup {
            display: none;
            position: absolute;
            top: 0;
            left: 100%;
            margin-left: 10px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-size: 0.9em;
            width: 200px;
            z-index: 100;
        }
        .card:hover .hover-popup {
            display: block;
        }
        .card .hover-popup h5 {
            margin: 0 0 5px 0;
        }
        .card .hover-popup p {
            margin: 0;
        }
        #battle-log {
            height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
        }
        .card-popup {
            position: fixed;
            right: -350px;
            top: 0;
            width: 300px;
            height: 100%;
            background-color: #f4f4f4;
            border-left: 1px solid #ccc;
            box-shadow: -5px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease-in-out;
            z-index: 1000;
            overflow-y: auto;
        }
        .card-popup.open {
            right: 0;
        }
        .popup-content {
            padding: 20px;
        }
        .close-btn {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .popup-content p {
            margin: 5px 0;
        }
        .popup-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        #sort-controls {
            text-align: center;
            margin-bottom: 10px;
        }
        .deck-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .upgrades-section {
            text-align: center;
        }
        .upgrades-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }
        #bonus-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            padding: 10px;
        }
        .bonus-stat-item {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        .bonus-stat-item h4 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
        }
        .bonus-stat-item p {
            margin: 0;
            color: #555;
        }
        @media (max-width: 700px) {
            body {
                padding: 5px;
            }
            .container {
                max-width: 100vw;
                padding: 8px;
                border-radius: 0;
                box-shadow: none;
            }
            h1, h2 {
                font-size: 1.3em;
            }
            .section {
                padding: 6px;
                margin-bottom: 12px;
            }
            .resource-display {
                flex-direction: column;
                font-size: 1em;
                gap: 8px;
            }
            .button-group, .deck-controls, .upgrades-container {
                flex-direction: column !important;
                gap: 5px !important;
            }
            #deck-display, #card-display {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 4px;
                padding: 4px;
                min-height: 100px;
            }
            .card, .battle-card {
                width: 95px !important;
                min-width: 85px;
                padding: 4px;
                font-size: 0.82em;
            }
            .card .hover-popup {
                left: auto;
                right: 0;
                top: 100%;
                width: 170px;
                margin-left: 0;
                margin-top: 6px;
            }
            #battle-log, .battle-log-overlay {
                font-size: 0.85em;
                height: 100px;
            }
            .card-popup {
                width: 100vw !important;
                right: 0 !important;
                left: 0 !important;
                top: 0 !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                height: 100vh !important;
                max-width: none !important;
            }
            .popup-content {
                padding: 12px !important;
            }
            .close-btn {
                font-size: 32px !important;
            }
            .popup-buttons {
                flex-direction: column;
                gap: 7px;
                margin-top: 16px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Monster TCG</h1>
        <p>Welcome to the Monster TCG! Collect cards, upgrade them, and battle to progress.</p>

        <div class="section resource-display">
            <div class="resource-item">
                <div>üí∞ Gold:</div>
                <div class="resource-value" id="gold">400</div>
                <div class="resource-per-second">(+<span id="gold-gain">0</span>/s)</div>
            </div>
            <div class="resource-item">
                <div>‚ú® Mana:</div>
                <div class="resource-value" id="mana">0</div>
                <div class="resource-per-second">(+<span id="mana-gain">0</span>/s)</div>
            </div>
            <div class="resource-item">
                <div>üõ°Ô∏è Stage:</div>
                <div class="resource-value" id="stage">1</div>
            </div>
        </div>

        <div class="section">
            <h2>Actions</h2>
            <div class="button-group">
                <button id="buyPackBtn" class="btn">Buy Card Pack (100 Gold)</button>
                <button id="startBattleBtn" class="btn" disabled>Start Battle</button>
            </div>
        </div>
        
        <div class="section upgrades-section">
            <h2>Upgrades</h2>
            <div class="upgrades-container">
                <button id="upgradePack5xBtn" class="btn" data-cost="5000" disabled>5x Pack Open (5000 Gold)</button>
                <button id="upgradePack10xBtn" class="btn" data-cost="20000" disabled>10x Pack Open (20000 Gold)</button>
                <button id="upgradeAutoBattleBtn" class="btn" data-cost="10000" disabled>Auto-Battle (10000 Gold)</button>
            </div>
        </div>

        <div class="section">
            <h2>Your Deck (<span id="deck-count">0</span>/4)</h2>
            <div id="deck-display">
                <p>Drag or add cards here to form your battle deck!</p>
            </div>
        </div>

        <div class="section">
            <h2>Your Cards</h2>
            <div id="sort-controls">
                Sort by:
                <button class="btn sort-btn" data-sort="level">Level</button>
                <button class="btn sort-btn" data-sort="rarity">Rarity</button>
                <button class="btn sort-btn" data-sort="idleGold">Idle Gold</button>
                <button class="btn sort-btn" data-sort="idleMana">Idle Mana</button>
                <button class="btn sort-btn" data-sort="allStatsBoost">All Stats</button>
            </div>
            <div id="card-display">
                <p>Buy a card pack to get your first card!</p>
            </div>
        </div>

        <div class="section">
            <h2>Battle Log</h2>
            <div id="battle-log"></div>
        </div>

        <div class="section">
            <h2>Current Bonuses</h2>
            <div id="bonus-stats">
            </div>
        </div>
    </div>

    <div id="card-popup" class="card-popup">
        <div class="popup-content">
            <span class="close-btn">&times;</span>
            <h3 id="popup-card-name"></h3>
            <p><strong>Rarity:</strong> <span id="popup-card-rarity"></span></p>
            <p><strong>Level:</strong> <span id="popup-card-level"></span></p>
            <p><strong>XP:</strong> <span id="popup-card-xp"></span></p>
            <p><strong>Attack:</strong> <span id="popup-card-attack"></span></p>
            <p><strong>Defense:</strong> <span id="popup-card-defense"></span></p>
            <p id="popup-ability-row"><strong>Ability:</strong> <span id="popup-card-ability"></span></p>
            <div class="popup-buttons">
                <button id="addToDeckBtn" class="btn" style="display:none;">Add to Deck</button>
                <button id="removeFromDeckBtn" class="btn" style="display:none;">Remove from Deck</button>
                <button id="upgradeCardBtn" class="btn" disabled>Upgrade Selected Card</button>
            </div>
        </div>
    </div>

    <script>
    // --- GAME DATA ---
    const DECK_SIZE = 4;
    const rarityOrder = { "Common": 1, "Uncommon": 2, "Rare": 3, "Epic": 4, "Legendary": 5 };
    const allAbilities = {
        idleGold: { name: "Idle Gold Gain", unit: "/s", isPercentage: false, icon: "üí∞", type: "idle" },
        idleMana: { name: "Idle Mana Gain", unit: "/s", isPercentage: false, icon: "‚ú®", type: "idle" },
        rarityLuck: { name: "Rarity Luck", unit: "%", isPercentage: true, icon: "üçÄ", type: "active" },
        extraDraw: { name: "Extra Draw Chance", unit: "%", isPercentage: true, icon: "üÉè", type: "active" },
        freeDrawChance: { name: "Free Pack Chance", unit: "%", isPercentage: true, icon: "üéÅ", type: "active" },
        battleGold: { name: "Battle Gold Bonus", unit: "%", isPercentage: true, icon: "ü™ô", type: "active" },
        battleMana: { name: "Battle Mana Bonus", unit: "%", isPercentage: true, icon: "üí†", type: "active" },
        battleXP: { name: "Battle XP Bonus", unit: "%", isPercentage: true, icon: "‚ú®", type: "active" },
        battleRewardsBoost: { name: "All Battle Rewards Boost", unit: "%", isPercentage: true, icon: "üèÜ", type: "active" },
        manaCostReduction: { name: "Mana Cost Reduction", unit: "%", isPercentage: true, icon: "üìâ", type: "idle" },
        allStatsBoost: { name: "All Cards Stat Boost", unit: "%", isPercentage: true, icon: "üìà", type: "idle" },
    };
    const fullCardPool = [
        // Common
        { id: "goblinGrunt", name: "Goblin Grunt", rarity: "Common", baseAttack: 5, baseDefense: 10, ability: { type: "idleGold", value: 0.5, description: "Adds {val} to idle gold per second." } },
        { id: "forestImp", name: "Forest Imp", rarity: "Common", baseAttack: 3, baseDefense: 7, ability: { type: "extraDraw", value: 0.02, description: "{val}% chance to pull an extra card from pack." } },
        { id: "ogreWarrior", name: "Ogre Warrior", rarity: "Common", baseAttack: 15, baseDefense: 25, ability: { type: "battleGold", value: 0.05, description: "Increases battle gold rewards by {val}%." } },
        { id: "mudMonster", name: "Mud Monster", rarity: "Common", baseAttack: 8, baseDefense: 18, ability: { type: "battleMana", value: 0.05, description: "Increases battle mana rewards by {val}%." } },
        { id: "ironGolem", name: "Iron Golem", rarity: "Common", baseAttack: 12, baseDefense: 22, ability: { type: "battleXP", value: 0.05, description: "Increases battle XP gain by {val}%." } },
        // Uncommon
        { id: "stoneGolem", name: "Stone Golem", rarity: "Uncommon", baseAttack: 10, baseDefense: 30, ability: { type: "battleRewardsBoost", value: 0.1, description: "Increases all battle rewards by {val}%." } },
        { id: "mushroomMage", name: "Mushroom Mage", rarity: "Uncommon", baseAttack: 15, baseDefense: 5, ability: { type: "idleGold", value: 1.0, description: "Adds {val} to idle gold per second." } },
        // Rare
        { id: "holyPaladin", name: "Holy Paladin", rarity: "Rare", baseAttack: 20, baseDefense: 25, ability: { type: "rarityLuck", value: 0.05, description: "Increases chance of pulling rare cards by {val}%." } },
        // Epic
        { id: "dragonKnight", name: "Dragon Knight", rarity: "Epic", baseAttack: 40, baseDefense: 40, ability: { type: "battleXP", value: 0.25, description: "Increases battle XP gain by {val}%." } },
        // Legendary
        { id: "phoenix", name: "Phoenix", rarity: "Legendary", baseAttack: 50, baseDefense: 50, ability: { type: "freeDrawChance", value: 0.02, description: "{val}% chance for a free pack draw." } }
    ];

    // --- GAME STATE ---
    const gameState = {
        gold: 400,
        mana: 0,
        stage: 1,
        cards: [],
        deck: [],
        selectedCardId: null,
        sortType: 'level',
        packMultiplier: 1
    };

    // --- UTILS ---
    function getAbilityValue(type) {
        let total = 0;
        let cardsToCheck = type in allAbilities ? (allAbilities[type].type === "active" ? gameState.deck.map(id => findCardById(id)) : gameState.cards) : [];
        cardsToCheck.forEach(card => {
            if (card && card.ability && card.ability.type === type) {
                total += card.ability.value * card.level;
            }
        });
        return total;
    }
    function findCardById(id) {
        return gameState.cards.find(card => card.id === id);
    }
    function getUpgradeCost(level) {
        let baseCost = 50;
        let manaCostReduction = getAbilityValue("manaCostReduction");
        return (baseCost + (level - 1) * 25) * (1 - manaCostReduction);
    }
    function log(msg) {
        const entry = document.createElement('p');
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
        document.getElementById('battle-log').prepend(entry);
    }

    // --- UI ELEMENTS ---
    const goldEl = document.getElementById('gold');
    const manaEl = document.getElementById('mana');
    const stageEl = document.getElementById('stage');
    const goldGainEl = document.getElementById('gold-gain');
    const manaGainEl = document.getElementById('mana-gain');
    const deckCountEl = document.getElementById('deck-count');
    const cardDisplay = document.getElementById('card-display');
    const deckDisplay = document.getElementById('deck-display');
    const buyPackBtn = document.getElementById('buyPackBtn');
    const startBattleBtn = document.getElementById('startBattleBtn');
    const upgradeCardBtn = document.getElementById('upgradeCardBtn');
    const addToDeckBtn = document.getElementById('addToDeckBtn');
    const removeFromDeckBtn = document.getElementById('removeFromDeckBtn');
    const popup = document.getElementById('card-popup');
    const closeBtn = document.querySelector('.close-btn');
    const sortBtns = document.querySelectorAll('.sort-btn');

    // --- RENDERERS ---
    function updateUI() {
        goldEl.textContent = gameState.gold.toFixed(1);
        manaEl.textContent = gameState.mana.toFixed(1);
        stageEl.textContent = gameState.stage;
        goldGainEl.textContent = (5 + getAbilityValue("idleGold")).toFixed(1);
        manaGainEl.textContent = (gameState.stage < 5 ? 0 : 5 + getAbilityValue("idleMana")).toFixed(1);
        deckCountEl.textContent = gameState.deck.length;
        displayCards();
        displayDeckCards();
        displayBonusStats();
        updateButtonStates();
    }
    function displayCards() {
        cardDisplay.innerHTML = '';
        const cardsNotInDeck = gameState.cards.filter(c => !gameState.deck.includes(c.id));
        if (cardsNotInDeck.length === 0) {
            cardDisplay.innerHTML = '<p>Your cards are either in your deck or you haven\'t bought any yet.</p>';
            return;
        }
        let sortedCards = [...cardsNotInDeck];
        if (gameState.sortType === 'level') sortedCards.sort((a, b) => b.level - a.level || b.xp - a.xp);
        else if (gameState.sortType === 'rarity') sortedCards.sort((a, b) => rarityOrder[b.rarity] - rarityOrder[a.rarity]);
        else if (allAbilities[gameState.sortType]) sortedCards.sort((a, b) => {
            const valA = (a.ability && a.ability.type === gameState.sortType) ? a.ability.value * a.level : 0;
            const valB = (b.ability && b.ability.type === gameState.sortType) ? b.ability.value * b.level : 0;
            return valB - valA || b.level - a.level;
        });
        sortedCards.forEach(card => {
            const cardDiv = createCardElement(card);
            cardDiv.classList.add('not-in-deck');
            cardDisplay.appendChild(cardDiv);
        });
    }
    function displayDeckCards() {
        deckDisplay.innerHTML = '';
        const deckCards = gameState.deck.map(id => findCardById(id));
        if (deckCards.length === 0) deckDisplay.innerHTML = '<p>Drag or add cards here to form your battle deck!</p>';
        deckCards.forEach(card => {
            const cardDiv = createCardElement(card);
            cardDiv.classList.add('in-deck');
            deckDisplay.appendChild(cardDiv);
        });
    }
    function createCardElement(card) {
        const cardDiv = document.createElement('div');
        cardDiv.className = `card ${card.rarity}`;
        cardDiv.setAttribute('data-card-id', card.id);
        cardDiv.addEventListener('click', () => {
            gameState.selectedCardId = card.id;
            showCardDetails(card);
        });
        let abilityIcon = '';
        let hoverPopupHtml = '';
        if (card.ability && allAbilities[card.ability.type]) {
            const abilityInfo = allAbilities[card.ability.type];
            abilityIcon = abilityInfo.icon;
            const formattedVal = (card.ability.value * (abilityInfo.isPercentage ? 100 : 1)).toFixed(2);
            const abilityText = card.ability.description.replace('{val}', formattedVal);
            hoverPopupHtml = `
                <div class="hover-popup">
                    <h5>${abilityInfo.icon} ${abilityInfo.name}</h5>
                    <p>${abilityText}</p>
                </div>
            `;
        }
        if (gameState.selectedCardId === card.id) cardDiv.classList.add('selected');
        cardDiv.innerHTML = `
            <h4>${card.name}</h4>
            <p>${abilityIcon} Lvl: ${card.level}</p>
            <p>‚öîÔ∏è ${card.attack} | üõ°Ô∏è ${card.defense}</p>
            ${hoverPopupHtml}
        `;
        return cardDiv;
    }
    function displayBonusStats() {
        const bonusStatsEl = document.getElementById('bonus-stats');
        bonusStatsEl.innerHTML = '';
        for (const type in allAbilities) {
            const abilityInfo = allAbilities[type];
            let value = getAbilityValue(type);
            if (value === 0) continue;
            let displayVal = abilityInfo.isPercentage ? (value * 100).toFixed(2) + abilityInfo.unit : value.toFixed(2) + abilityInfo.unit;
            bonusStatsEl.innerHTML += `<div class="bonus-stat-item"><h4>${abilityInfo.icon} ${abilityInfo.name}</h4><p>${displayVal}</p></div>`;
        }
    }
    function updateButtonStates() {
        buyPackBtn.disabled = gameState.gold < 100;
        startBattleBtn.disabled = gameState.deck.length < DECK_SIZE;
    }

    // --- POPUP LOGIC ---
    function showCardDetails(card) {
        const selected = card || findCardById(gameState.selectedCardId);
        if (!selected) return;
        document.getElementById('popup-card-name').textContent = selected.name;
        document.getElementById('popup-card-rarity').textContent = selected.rarity;
        document.getElementById('popup-card-level').textContent = selected.level;
        document.getElementById('popup-card-xp').textContent = `${selected.xp || 0}/${selected.nextLevelXP || 10}`;
        document.getElementById('popup-card-attack').textContent = selected.attack;
        document.getElementById('popup-card-defense').textContent = selected.defense;
        const abilityLabel = document.getElementById('popup-ability-row').querySelector('strong');
        const abilityText = document.getElementById('popup-card-ability');
        if (selected.ability) {
            const abilityInfo = allAbilities[selected.ability.type];
            const formattedVal = (selected.ability.value * (abilityInfo.isPercentage ? 100 : 1)).toFixed(2);
            abilityText.textContent = selected.ability.description.replace('{val}', formattedVal);
            abilityLabel.textContent = `${abilityInfo.type === 'idle' ? 'Idle Ability' : 'Active Ability'}:`;
        } else {
            abilityText.textContent = 'None';
            abilityLabel.textContent = 'Ability:';
        }
        const upgradeCost = getUpgradeCost(selected.level);
        upgradeCardBtn.textContent = `Upgrade Selected Card (${upgradeCost.toFixed(0)} Mana)`;
        upgradeCardBtn.disabled = gameState.mana < upgradeCost;

        if (gameState.deck.includes(selected.id)) {
            addToDeckBtn.style.display = 'none';
            removeFromDeckBtn.style.display = 'inline-block';
        } else if (gameState.deck.length < DECK_SIZE) {
            addToDeckBtn.style.display = 'inline-block';
            removeFromDeckBtn.style.display = 'none';
        } else {
            addToDeckBtn.style.display = 'none';
            removeFromDeckBtn.style.display = 'none';
        }
        popup.classList.add('open');
    }
    closeBtn.onclick = function() {
        popup.classList.remove('open');
        gameState.selectedCardId = null;
        updateUI();
    };
    addToDeckBtn.onclick = function() {
        const cardId = gameState.selectedCardId;
        if (!gameState.deck.includes(cardId) && gameState.deck.length < DECK_SIZE) {
            gameState.deck.push(cardId);
            updateUI();
            showCardDetails(findCardById(cardId));
        }
    };
    removeFromDeckBtn.onclick = function() {
        const cardId = gameState.selectedCardId;
        const idx = gameState.deck.indexOf(cardId);
        if (idx >= 0) {
            gameState.deck.splice(idx, 1);
            updateUI();
            showCardDetails(findCardById(cardId));
        }
    };

    // --- CARD ACQUISITION ---
    buyPackBtn.onclick = function() {
        if (gameState.gold < 100) return;
        gameState.gold -= 100;
        // Simple random from pool for demo
        const cardTemplate = fullCardPool[Math.floor(Math.random() * fullCardPool.length)];
        const newCard = {
            id: `${cardTemplate.id}-${Date.now()}`,
            name: cardTemplate.name,
            rarity: cardTemplate.rarity,
            baseAttack: cardTemplate.baseAttack,
            baseDefense: cardTemplate.baseDefense,
            attack: cardTemplate.baseAttack,
            defense: cardTemplate.baseDefense,
            xp: 0,
            level: 1,
            nextLevelXP: 10,
            ability: cardTemplate.ability ? JSON.parse(JSON.stringify(cardTemplate.ability)) : null
        };
        gameState.cards.push(newCard);
        log(`You acquired ${newCard.name} (${newCard.rarity})!`);
        updateUI();
    };

    // --- CARD UPGRADE ---
    upgradeCardBtn.onclick = function() {
        const card = findCardById(gameState.selectedCardId);
        if (!card) return;
        const cost = getUpgradeCost(card.level);
        if (gameState.mana < cost) return;
        gameState.mana -= cost;
        card.level++;
        card.xp = 0;
        card.nextLevelXP = card.level * 10;
        card.attack = Math.round(card.baseAttack * (1 + (card.level - 1) * 0.1));
        card.defense = Math.round(card.baseDefense * (1 + (card.level - 1) * 0.1));
        if (card.ability) card.ability.value *= 1.1;
        log(`${card.name} upgraded to level ${card.level}.`);
        updateUI();
        showCardDetails(card);
    };

    // --- SORT CONTROLS ---
    sortBtns.forEach(btn => {
        btn.onclick = function() {
            gameState.sortType = btn.getAttribute('data-sort');
            updateUI();
        };
    });

    // --- INIT ---
    updateUI();
    </script>
</body>
</html>